{"version":3,"sources":["../../../src/home/controller/index.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;;;;;;;;;;;;;;;qBAQQ,W;;gBAEA,Q,EAaE,I,EAEK,C,EACD,M,EACA,O,EACA,O;;;;;;mCAlBW,KAAK,OAAL,CAAa,SAAb,C;;;AAAjB,oC;;AACJ,gCAAI,QAAJ,EAAc;AACV,qCAAK,MAAL,CAAY;AACR,8CAAU;AADF,iCAAZ;AAGH,6BAJD,MAKK;AACD,qCAAK,MAAL,CAAY;AACR,8CAAU;AADF,iCAAZ;AAGH;;;;mCAGkB,KAAK,KAAL,CAAW,UAAX,EAAuB,MAAvB,E;;;AAAb,gC;;;AAEJ,iCAAS,CAAT,GAAW,CAAX,EAAa,IAAE,KAAK,MAApB,EAA2B,GAA3B,EAAgC;AACxB,sCADwB,GACf,KAAK,CAAL,EAAQ,MAAR,IAAkB,EADH;AAExB,uCAFwB,GAEd,KAAK,CAAL,EAAQ,IAAR,IAAgB,IAAI,IAAJ,EAFF;AAGxB,uCAHwB,GAGd,OAAO,KAAP,CAAa,eAAK,GAAlB,KAA0B,EAHZ;;AAI5B,qCAAK,CAAL,EAAQ,IAAR,GAAe,MAAM,QAAN,CAAe,OAAf,EAAwB,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAAf;AACA,qCAAK,CAAL,EAAQ,MAAR,GAAiB,aAAa,QAAQ,MAAR,CAAe,CAAC,CAAhB,EAAkB,CAAlB,EAAqB,IAArB,CAA0B,eAAK,GAA/B,CAA9B;AACH;AACD,iCAAK,MAAL,CAAY;AACR,0CAAU,QAAQ;AADV,6BAAZ;;6DAIK,KAAK,OAAL,E;;;;;;;;;;;;;;;;;;;qBAGD,W;;gBAGI,Q,EACA,Q,EACA,I;;;;;iCAHJ,KAAK,MAAL,E;;;;;AACI,oC,GAAW,KAAK,IAAL,E;AACX,oC,GAAW,SAAS,Q;;mCACP,KAAK,KAAL,CAAW,OAAX,EAAoB,KAApB,CAA0B,UAA1B,EAAsC,KAAtC,CAA4C,EAAC,UAAS,QAAV,EAA5C,EAAiE,MAAjE,E;;;AAAb,gC;;kCAEA,KAAK,CAAL,EAAQ,QAAR,KAAqB,SAAS,Q;;;;;;mCACxB,KAAK,OAAL,CAAa,SAAb,EAAwB,QAAxB,C;;;AACN,iCAAK,OAAL,CAAa;AACT,yCAAS,IADA;AAET,0CAAU;AAFD,6BAAb;;;;;AAMA,iCAAK,QAAL,CAAc,eAAd;;;;;;;8DAIC,KAAK,OAAL,E;;;;;;;;;;;;;;;;;;;;qBAML,U;;gBACE,Q,EACA,I,EACA,O;;;;;;mCAFiB,KAAK,OAAL,CAAa,SAAb,C;;;AAAjB,oC;;mCACa,KAAK,KAAL,CAAW,OAAX,EAAoB,KAApB,CAA0B,EAAC,UAAS,QAAV,EAA1B,EAA+C,MAA/C,E;;;AAAb,gC;AACA,mC,GAAU,KAAK,CAAL,C;;AACd,iCAAK,MAAL,CAAY;AACR,0CAAU,QAAQ,QAAR,IAAoB,EADtB;AAER,oCAAI,QAAQ,EAAR,IAAc,EAFV;AAGR,uCAAO,QAAQ,KAAR,IAAiB,EAHhB;AAIR,wCAAQ,QAAQ,MAAR,IAAkB,EAJlB;AAKR,uCAAO,QAAQ,KAAR,IAAiB,EALhB;AAMR,6CAAa,QAAQ,WAAR,IAAuB;AAN5B,6BAAZ;AAQA,iCAAK,MAAL,CAAY;AACR,0CAAU;AADF,6BAAZ;AAGA,iCAAK,OAAL","file":"index.js","sourcesContent":["'use strict';\n\nimport Base from './base.js';\nimport path from 'path';\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  // index.html\n  async indexAction(){\n    //auto render template file index_index.html\n    var username = await this.session('islogin');\n    if (username) {\n        this.assign({\n            username: username\n        });\n    }\n    else {\n        this.assign({\n            username: ''\n        });\n    }\n\n      // 展示作品\n      let data = await this.model('articles').select();\n\n      for (let i=0;i<data.length;i++) {\n          var oriImg = data[i].images || '';\n          var oriDate = data[i].date || new Date();\n          var pathArr = oriImg.split(path.sep) || [];\n          data[i].date = think.datetime(oriDate).split(' ')[0];\n          data[i].images = '/static/' + pathArr.splice(-2,2).join(path.sep);\n      }\n      this.assign({\n          datalist: data || []\n      });\n\n    return this.display();\n  }\n    // 登录操作\n    async loginAction(){\n\n      if (this.isPost()) {\n          let postData = this.post();\n          let username = postData.username;\n          let data = await this.model('users').field('password').where({username:username}).select();\n\n          if (data[0].password === postData.password) {\n              await this.session('islogin', username);\n              this.success({\n                  logined: true,\n                  username: username\n              });\n          }\n          else {\n              this.redirect('/index/login/');\n          }\n      }\n      else {\n        return this.display();\n      }\n      \n    }\n\n    // 个人信息\n    async infoAction() {\n        let username = await this.session('islogin');\n        let data = await this.model('users').where({username:username}).select();\n        let rowData = data[0];\n        this.assign({\n            nickname: rowData.nickname || '',\n            qq: rowData.qq || '',\n            email: rowData.email || '',\n            skills: rowData.skills || '',\n            years: rowData.years || '',\n            description: rowData.description || ''\n        });\n        this.assign({\n            username: username\n        });\n        this.display();\n    }\n}"]}